name: demoIndexPipeline
steps:
  - step: KnowledgeBaseFiles
    name: input
    step_args:
      knowledgebase_names: ["demoKnowledgeBase"]
    depends_on: []

  - step: Chunker
    name: simple_chunker
    step_args:
      chunk_size_words: 320
      chunk_overlap: 30
      split_by: word
      split_respect_sentence_boundary: true
      hard_split_max_chars: 2400
    depends_on: [input]

  - step: SentenceTransformerEmbedder
    name: sentence-transformers
    step_args:
      model_name: BAAI/bge-base-en-v1.5
      include_metadata: [ title, file_name ]
    depends_on: [ simple_chunker ]

  - step: LexRank
    name: lexranker_file
    step_args:
      scope: file
    depends_on: [ sentence-transformers ]

  - step: LouvainCommunityDetection
    name: louvain
    step_args:
      assign_labels: gpt-3.5-turbo # RateLimit later
    depends_on: [ lexranker_file ]

  - step: ChunkWriter
    name: save
    step_args:
#      duplicates: overwrite on file_name
      vector_index_name: demoVectorIndex
    depends_on: [louvain]
