index:

  name: basic_index

  stages:
    - stage: Preprocessor
      steps:
        - step: OCPreprocessor
          name: simple_pre_processor
          step_args:
            add_punctuation: false
            remove_whitespace: false
          depends_on: [ ]

    - stage: Chunker
      steps:
        - step: OCChunker
          name: simple_chunker
          step_args:
            chunk_size_words: 320
            chunk_overlap: 30
            split_by: word
            split_respect_sentence_boundary: true
            hard_split_max_chars: 2400
          depends_on: [ simple_pre_processor ]

    - stage: Embedder
      steps:
        - step: SentenceTransformerEmbedder
          name: sentence-transformers
          step_args:
            model_name: BAAI/bge-base-en-v1.5
            batch_size: 4
            include_metadata: [ title, file_name ]
          depends_on: [ simple_chunker ]

    - stage: Scorer
      steps:
        - step: LexRank
          name: lexranker
          step_args:
            threshold: 0.1
            param_a: 1
            param_b: 2
          depends_on: [ sentence-transformers ]

    - stage: Clusterer
      steps:
        - step: LouvainCommunityDetection
          name: louvain
          step_args:
            random_state: 42
            resolution: 0.4
            assign_labels: gpt-3.5-turbo # RateLimit later
          depends_on: [ lexranker ]


query:

  name: basic_query

  stages:
    - stage: Retriever

      steps:
        - step: OCRetriever
          name: retriever
          step_args:
            query: how much wood could a woodchuck chuck if a woodchuck could chuck wood
            model_name: BAAI/bge-base-en-v1.5
            top_k: 100
            metadata_filters: { }
          depends_on: [ ]

    - stage: Reranker

      steps:
        - step: OCReranker
          name: simple_reranker
          step_args:
            model_name: BAAI/bge-reranker-large
            top_k: 10
            metadata_filters: { }
          depends_on: [ retriever ]
